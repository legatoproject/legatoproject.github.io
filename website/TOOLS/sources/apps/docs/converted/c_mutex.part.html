<div class="header">
<div class="headertitle">
<h1 class="title">Mutex API </h1> </div>
</div><div class="contents">
<div class="textblock"><p><a class="el" href="le__mutex_8h.html">API Reference</a></p>
<hr />
<p>The Mutex API provides standard mutex functionality with added diagnostics capabilities. These mutexes can be shared by threads within the same process, but can't be shared by threads in different processes.</p>
<dl class="section warning"><dt>Warning</dt><dd>Multithreaded programming is an advanced subject with many pitfalls. A general discussion of why and how mutexes are used in multithreaded programming is beyond the scope of this documentation. If you are not familiar with these concepts <em>please</em> seek out training and mentorship before attempting to work on multithreaded production code.</dd></dl>
<p>Two kinds of mutex are supported by Legato:</p>
<ul>
<li><b>Recursive</b> or</li>
<li><b>Non-Recursive</b> </li>
</ul>
<p>All mutexes can be locked and unlocked. The same lock, unlock, and delete functions work for all the mutexes, regardless of what type they are.</p>
<p>A recursive mutex can be locked again by the same thread that already has the lock, but a non-recursive mutex can only be locked once before being unlocked.</p>
<p>If a thread grabs a non-recursive mutex lock and then tries to grab that same lock again, a deadlock occurs. Legato's non-recursive mutexes will detect this deadlock, log a fatal error and terminate the process.</p>
<p>If a thread grabs a recursive mutex, and then the same thread grabs the same lock again, the mutex's "lock count" is incremented. When the thread unlocks that mutex, the lock count is decremented. Only when the lock count reaches zero will the mutex actually unlock.</p>
<p>There's a limit to the number of times the same recursive mutex can be locked by the same thread without ever unlocking it, but that limit is so high (at least 2 billion), if that much recursion is going on, there are other, more serious problems with the program.</p>
<h1><a class="anchor" id="c_mutex_create"></a>
Creating a Mutex</h1>
<p>In Legato, mutexes are dynamically allocated objects. Functions that create them return references to them (of type le_mutex_Ref_t).</p>
<p>Functions for creating mutexes:</p>
<ul>
<li><code><a class="el" href="le__mutex_8h.html#ac7dd2b69f4b905d56df969c9085a570b">le_mutex_CreateRecursive()</a></code> - creates a <b>normal</b>, <b>recursive</b> mutex.</li>
<li><code><a class="el" href="le__mutex_8h.html#a602e2c18e646db7af0d68bb5fb103207">le_mutex_CreateNonRecursive()</a></code> - creates a <b>normal</b>, <b>non-recursive</b> mutex.</li>
</ul>
<p>All mutexes have names, required for diagnostic purposes. See <a class="el" href="c_mutex.html#c_mutex_diagnostics">Diagnostics</a> below.</p>
<h1><a class="anchor" id="c_mutex_locking"></a>
Using a Mutex</h1>
<p>Functions for locking and unlocking mutexes:</p>
<ul>
<li><code><a class="el" href="le__mutex_8h.html#ad5b7d94710f420cd945229648e7a80e7">le_mutex_Lock()</a></code> </li>
<li><code><a class="el" href="le__mutex_8h.html#aae68b71222e20c55ff3bf2d7b52e3009">le_mutex_Unlock()</a></code> </li>
<li><code><a class="el" href="le__mutex_8h.html#a43864999f70f0a825cf8ca87f9a2ee2c">le_mutex_TryLock()</a></code> </li>
</ul>
<p>It doesn't matter what type of mutex you are using, you still use the same functions for locking and unlocking your mutex.</p>
<h1><a class="anchor" id="c_mutex_delete"></a>
Deleting a Mutex</h1>
<p>When you are finished with a mutex, you must delete it by calling <a class="el" href="le__mutex_8h.html#a38571fa1d9c15d5f30ea9c480d8810c6">le_mutex_Delete()</a>.</p>
<p>There must not be anyone using the mutex when it is deleted (i.e., no one can be holding it).</p>
<h1><a class="anchor" id="c_mutex_diagnostics"></a>
Diagnostics</h1>
<p>The command-line diagnostic tool <a class="el" href="tools_target_inspect.html">inspect</a> can be used to list the mutexes that currently exist inside a given process. The state of each mutex can be seen, including a list of any threads that might be waiting for that mutex.</p>
<hr />
<p>Copyright (C) Sierra Wireless Inc. Use of this work is subject to license. </p>
</div></div>